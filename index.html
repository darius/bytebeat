<form id="form">
  <input id="play" type="submit" value="Play"> 
  <input id="code0" type="text" size="50" value="t ^ t>>8"> and optionally
  <input id="code1" type="text" size="50" value=""><br>for
  <input id="duration" type="text" size="1" value="25"> seconds at
  <input name="samplerate" type="radio" value="8000" checked>8 kHz
  <input name="samplerate" type="radio" value="11025">11 kHz
  <input name="samplerate" type="radio" value="22050">22 kHz
  <input name="samplerate" type="radio" value="44100">44 kHz.
</form>
<audio id="player" autoplay="true" controls></audio>
<p>
<canvas id="viz" height="256" width="768"></canvas>
<p id="error">
<hr>By <a href="http://wry.me/blog">Darius</a>. See <a href="http://canonical.org/~kragen/bytebeat/">Kragen's
  overview</a>. <a href="https://github.com/darius/bytebeat">Source
  code</a> on github. Based
  on <a href="http://www.bemmu.com/music/index.html">Bemmu and
  viznut's</a>
  and <a href="http://wurstcaptures.untergrund.net/music/">rarefluid's</a>.
  This page is functionally similar but updates the sound more quickly
  after you edit the expression (at this writing, by my tests). This
  matters most up at 44 kHz.

<script src="bytebeat.js"></script>
<script>

function dbg(msg) {
    if (window.console)
	console.log(msg);
}
function byId(id) {
    return document.getElementById(id);
}
var code0      = byId('code0');
var code1      = byId('code1');
var samplerate = byId('form').samplerate;
var player     = byId('player');
var viz        = byId('viz');
var error      = byId('error');

if (typeof(player.play) === 'undefined')
    alert("Your browser doesn't seem to support HTML5 audio. Sorry.");

function play() {
    error.innerHTML = '';
    try {
        var composers = [compileComposer(nonempty(code0) ? code0.value : "0")];
        if (nonempty(code1)) composers.push(compileComposer(code1.value));

        var duration = parseFloat(byId('duration').value);
        if (duration === 0) duration = 15;

        var rate = parseInt(getCheckedValue(samplerate));

        showAudioVisual(makeSound(composers, duration, rate, 1),
                        player, viz);
    } catch (err) {
        error.innerHTML = '' + err;
    }
    return false;
}

function nonempty(field) {
    return field.value.match(/\S/);
}

function getCheckedValue(buttons) {
    for (var i = 0; i < buttons.length; ++i)
        if (buttons[i].checked)
            return buttons[i].value;
}

code0.focus();
byId('play').onclick = play;

</script>
