<form>
  <input id="code" type="text" value="sin(1e-4 * t) * 255"><br>
  <input id="play" type="submit" value="Play">
</form>
<br><br><span id="error"></span><br>
<div id="player"></div>

<script src="bytebeat.js"></script>
<script>
function byId(id) {
    return document.getElementById(id);
}

var audio = document.createElement('audio');
byId('player').appendChild(audio);
if (typeof(audio.play) === 'undefined') {
    alert("Your browser doesn't seem to support audio. It's OK, you're not a bad person. But this app will fail.");
}

function play() {
    byId('error').innerText = "";
    try {
        playDataURI(reallyPlay(byId('code').value));
    } catch (err) {
        byId('error').innerHTML = "" + err;
    }
    return false;
}

function reallyPlay(code) {
    var frequency = 8000;
    var duration = 30;
    return makeAudioURI(frequency,
                        makeSound(compileComposer(code),
                                  frequency * duration));
}

function stopPlaying() {
    if (audio) {
        audio.pause();          // This is said to keep it from playing overlong,
        audio.src = "";         // though I haven't noticed any difference.
        byId('player').removeChild(audio);
    }
    audio = null;
}

function playDataURI(uri) {
    stopPlaying();
    audio = document.createElement('audio');
    audio.setAttribute('autoplay', true);
    audio.setAttribute('src', uri);
    audio.setAttribute('controls', 'controls');
    byId('player').appendChild(audio);
}

byId('code').focus();
byId('play').onclick = play;
</script>
