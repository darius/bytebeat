<form>
  <input id="code0" type="text" value="t ^ t>>8"><br>
  <input id="code1" type="text" value=""><br>
  <input id="play" type="submit" value="Play">
</form>
<audio id="player" autoplay="true" controls></audio>
<p>
<canvas id="viz" height="256" width="512"></canvas>
<p id="error">

<script src="bytebeat.js"></script>
<script>

function dbg(msg) {
    if (window.console)
	console.log(msg);
}
function byId(id) {
    return document.getElementById(id);
}
var code0 = byId('code0');
var code1 = byId('code1');
var error = byId('error');

if (typeof(player.play) === 'undefined') {
    alert("Your browser doesn't seem to support audio. It's OK, you're not a bad person. But this app will fail.");
}

function play() {
    error.innerHTML = '';
    try {
        var composers = [];
        if (nonempty(code0)) composers.push(compileComposer(code0.value));
        if (nonempty(code1)) composers.push(compileComposer(code1.value));
        showAudioVisual(makeSound(composers, 30, 8000, 1),
                        byId('player'), byId('viz'));
    } catch (err) {
        error.innerHTML = '' + err;
    }
    return false;
}

function nonempty(field) {
    return field.value.match(/\S/);
}

code0.focus();
byId('play').onclick = play;

</script>
